# ST008 - Questions & Clarifications

本文件記錄開發過程中需要澄清的問題與決策點。

---

## 🔴 Critical Questions (阻擋開發)

### Q1: 批次分配的失敗策略

**問題描述**:  
批次分配時，若部分會友分配失敗，應如何處理？

**選項**:
- A. 部分成功策略（已成功的不回滾，失敗的顯示錯誤訊息）
- B. 全部成功或全部失敗（Transaction，一個失敗則全部回滾）
- C. 僅顯示警告，不記錄失敗的會友

**目前採用方案**: A（部分成功策略）

**原因**:
- 符合使用者預期（已成功分配的會友不需要重複操作）
- Firestore Batch Write 支援部分成功
- 提供詳細的失敗清單，方便使用者重試

**影響範圍**: 
- `member.service.ts` 的 `batchAssignMembers` 方法
- `BatchAssignDialog.vue` 的錯誤處理邏輯

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q2: Audit Log 的實作範圍

**問題描述**:  
Audit Log（轉移歷史記錄）應在此 Story 實作多少？

**選項**:
- A. 僅實作 API 寫入，不實作查詢介面（推薦）
- B. 完整實作 Audit Log 的寫入與查詢介面
- C. 不實作 Audit Log，預留給 ST027

**目前採用方案**: A（僅實作寫入）

**原因**:
- ST027 專門負責審計日誌功能
- 此 Story 聚焦於成員調度功能
- 避免重複開發

**影響範圍**: 
- `member.service.ts` 的 `assignMember` 和 `transferMember` 方法
- 是否需要建立 `transfer_logs` Collection

**決策日期**: _待確認_  
**決策人**: _待確認_

---

## 🟡 High Priority Questions (影響 UX)

### Q3: 拖拉到牧區節點的處理方式

**問題描述**:  
當使用者拖拉會友到牧區節點（而非小組節點）時，應如何處理？

**選項**:
- A. 顯示錯誤 Toast：「請選擇小組，不能直接分配到牧區」
- B. 自動顯示快速分配對話框，預填該牧區，讓使用者選擇小組
- C. 自動分配到該牧區的「預設小組」（如第一個小組）

**目前採用方案**: A（顯示錯誤 Toast）

**原因**:
- 避免使用者誤操作
- 明確要求使用者選擇小組
- 簡化實作邏輯

**影響範圍**: 
- `DraggableTreeNode.vue` 的 `handleDrop` 方法

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q4: 批次分配的選擇上限

**問題描述**:  
批次分配應限制選擇多少位會友？

**選項**:
- A. 50 位（推薦）
- B. 100 位
- C. 不限制

**目前採用方案**: A（50 位）

**原因**:
- Firestore Batch Write 限制 500 筆，50 位會友可確保不超限
- 避免 UI 顯示過多會友導致效能問題
- 實務上很少需要一次分配 50 位以上會友

**影響範圍**: 
- `BatchAssignDialog.vue` 的選擇邏輯
- API 的驗證邏輯

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q5: 轉移確認訊息的格式

**問題描述**:  
轉移會友時，Toast 確認訊息應顯示哪些資訊？

**選項**:
- A. 簡化版：「已將 [會友姓名] 轉移至 [新小組名稱]」
- B. 詳細版：「已將 [會友姓名] 從 [原牧區] - [原小組] 轉移至 [新牧區] - [新小組]」
- C. 僅顯示成功，不顯示詳細資訊

**目前採用方案**: B（詳細版）

**原因**:
- 使用者需要確認轉移前後的歸屬
- 避免誤操作後不知道原歸屬

**影響範圍**: 
- `useMemberTransfer.ts` 的 Toast 訊息

**決策日期**: _待確認_  
**決策人**: _待確認_

---

## 🟢 Medium Priority Questions (功能細節)

### Q6: 拖拉預覽圖的設計

**問題描述**:  
拖拉會友卡片時，拖拉預覽圖（Drag Image）應顯示什麼？

**選項**:
- A. 顯示會友姓名（推薦）
- B. 顯示會友卡片的完整內容（頭像 + 姓名 + 標籤）
- C. 使用瀏覽器預設的拖拉圖（簡化實作）

**目前採用方案**: A（顯示會友姓名）

**原因**:
- 簡潔明瞭，減少視覺干擾
- 實作簡單

**影響範圍**: 
- `useDragAndDrop.ts` 的 `onDragStart` 方法

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q7: 拖拉目標的高亮樣式

**問題描述**:  
拖拉會友到小組節點時，高亮樣式應如何設計？

**選項**:
- A. 綠色背景 + 虛線邊框（可放置）、紅色背景 + 虛線邊框（不可放置）
- B. 僅改變邊框顏色（綠色 / 紅色）
- C. 顯示「+」圖示於節點中央

**目前採用方案**: A（綠色/紅色背景 + 虛線邊框）

**原因**:
- 視覺反饋明確
- 符合常見的拖拉 UI 設計

**影響範圍**: 
- `DraggableTreeNode.vue` 的樣式

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q8: 快速分配對話框的開啟時機

**問題描述**:  
快速分配對話框應在什麼時機開啟？

**選項**:
- A. 點擊待處理池的會友卡片時（推薦）
- B. 點擊會友卡片的「分配」按鈕時（需額外增加按鈕）
- C. 雙擊會友卡片時

**目前採用方案**: A（點擊卡片）

**原因**:
- 操作簡單，僅需一次點擊
- 不需要額外增加按鈕，節省空間

**影響範圍**: 
- `PendingMemberCard.vue` 的點擊事件處理

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q9: 批次分配的選擇模式

**問題描述**:  
批次分配時，如何選擇多位會友？

**選項**:
- A. 使用 Checkbox 勾選（推薦）
- B. 按住 Ctrl/Cmd 鍵點擊多選
- C. 使用「選擇模式」按鈕，開啟後可多選

**目前採用方案**: A（使用 Checkbox）

**原因**:
- 操作直覺，符合使用者習慣
- 視覺反饋明確（勾選狀態清楚）

**影響範圍**: 
- `PendingPool.vue` 的選擇邏輯
- `PendingMemberCard.vue` 需增加 Checkbox

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q10: 轉移歷史記錄的查詢入口

**問題描述**:  
轉移歷史記錄的查詢介面應放在哪裡？

**選項**:
- A. 會友詳情頁的「轉移歷史」Tab
- B. 組織架構頁面的「轉移歷史」按鈕（全域查詢）
- C. 小組詳情頁的「成員轉移紀錄」Tab

**目前採用方案**: A（會友詳情頁的 Tab）

**原因**:
- 符合使用者需求（查看特定會友的轉移歷史）
- 實作簡單，查詢範圍小

**影響範圍**: 
- 會友詳情頁的 Tab 設計
- ST027 的實作範圍

**決策日期**: _待確認_  
**決策人**: _待確認_

---

## 🔵 Low Priority Questions (錦上添花)

### Q11: 拖拉取消的快捷鍵

**問題描述**:  
拖拉過程中，是否支援 ESC 鍵取消拖拉？

**選項**:
- A. 支援（推薦）
- B. 不支援（僅拖拉至空白區域時取消）

**目前採用方案**: A（支援 ESC 取消）

**影響範圍**: 
- `useDragAndDrop.ts` 需監聽 ESC 鍵事件

**決策日期**: _待確認_  
**決策人**: _待確認_

---

### Q12: 批次分配的進度顯示

**問題描述**:  
批次分配時，是否需要顯示進度條？

**選項**:
- A. 顯示進度條（如：已處理 10/50 筆）
- B. 僅顯示 Loading Spinner
- C. 不顯示進度

**目前採用方案**: B（僅顯示 Loading Spinner）

**原因**:
- Firestore Batch Write 一次性提交，無法取得中間進度
- 簡化實作

**影響範圍**: 
- `BatchAssignDialog.vue` 的 Loading 狀態顯示

**決策日期**: _待確認_  
**決策人**: _待確認_

---

## 📝 Design Decisions (已決策)

### D1: 使用 HTML5 Drag & Drop API

**決策**: 使用原生 HTML5 Drag & Drop API 實作拖拉功能

**原因**:
- 瀏覽器原生支援，效能好
- 不需要額外的第三方函式庫
- PrimeVue 的 Drag & Drop 功能有限

---

### D2: 批次分配採用「部分成功」策略

**決策**: 批次分配失敗時，已成功的不回滾

**原因**:
- 符合使用者預期
- Firestore Batch Write 支援部分成功
- 提供詳細的失敗清單

---

### D3: Audit Log 僅實作寫入

**決策**: 此 Story 僅實作 Audit Log 的寫入邏輯，查詢介面由 ST027 負責

**原因**:
- 清楚的職責劃分
- 避免重複開發

---

## 📌 Notes & Assumptions

1. **拖拉功能**: 使用 HTML5 Drag & Drop API，需考慮瀏覽器相容性（現代瀏覽器皆支援）

2. **批次分配上限**: 設定為 50 位會友，避免 Firestore Batch Write 超限（500 筆）

3. **權限控制**: Zone Scope 僅能分配會友到自己的牧區，Global Scope 可分配到任何牧區

4. **Audit Log**: 僅實作寫入，查詢介面由 ST027 負責

5. **轉移與分配的差異**: 轉移會記錄原歸屬，分配則僅記錄新歸屬

---

**Last Updated**: 2026-02-16  
**Maintained By**: Development Team
